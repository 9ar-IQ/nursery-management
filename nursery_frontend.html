<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nursery Management System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .login-container { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1); max-width: 400px; margin: 100px auto; }
        .main-dashboard { background: white; border-radius: 15px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1); padding: 30px; }
        .loading { text-align: center; padding: 40px; font-size: 18px; color: #667eea; }
        .loading:after { content: '...'; animation: dots 1.5s steps(4, end) infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60%, 100% { content: '...'; } }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #f0f0f0; }
        .logo { font-size: 28px; font-weight: bold; color: #667eea; }
        .datetime-display { font-size: 14px; color: #666; margin-top: 5px; }
        .nav-menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .nav-button { padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s ease; }
        .nav-button:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3); }
        .nav-button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; margin-right: 10px; margin-bottom: 10px; transition: all 0.3s ease; }
        .btn-primary { background: #667eea; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: 'Segoe UI', Arial, sans-serif; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #667eea; }
        textarea { resize: vertical; }
        .table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        .table th, .table td { padding: 15px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        .table th { background: #f8f9fa; font-weight: 600; }
        .hidden { display: none !important; }
        .alert { padding: 15px; margin-bottom: 20px; border-radius: 8px; font-weight: 500; }
        .alert-success { background: #d4edda; color: #155724; }
        .alert-error { background: #f8d7da; color: #721c24; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; overflow-y: auto; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto; margin: 20px; }
        .close-modal { float: right; font-size: 24px; cursor: pointer; color: #999; }
        .quick-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; text-align: center; }
        .stat-number { font-size: 32px; font-weight: bold; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .settings-section { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .settings-section h3 { margin-bottom: 15px; color: #555; border-bottom: 1px solid #e0e0e0; padding-bottom: 10px; }
        .permission-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 10px; }
        .permission-item { padding: 10px; background: white; border-radius: 8px; }
        .permission-item label { margin-bottom: 5px; font-weight: 500; display: flex; align-items: center; }
        .permission-item input[type="checkbox"] { margin-right: 8px; width: auto; }
    </style>
</head>
<body>
    <div id="loginScreen">
        <div class="login-container">
            <h2 style="text-align: center; margin-bottom: 30px; color: #667eea;">Nursery Management System</h2>
            <div id="loginAlert"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                <p style="margin-top: 15px; text-align: center; color: #666; font-size: 12px;">Default: admin / admin123</p>
            </form>
        </div>
    </div>

    <div id="mainDashboard" class="hidden">
        <div class="container">
            <div class="main-dashboard">
                <div class="header">
                    <div>
                        <div class="logo">üè´ Nursery Management</div>
                        <div id="nurseryNameDisplay">My Nursery</div>
                        <div class="datetime-display" id="currentDateTime">Loading...</div>
                    </div>
                    <div>
                        <span id="currentUser">Welcome, Admin</span>
                        <button class="btn btn-secondary" onclick="logout()">Logout</button>
                    </div>
                </div>

                <div id="dashboardView">
                    <div class="quick-stats">
                        <div class="stat-card"><div class="stat-number" id="totalStudents">0</div><div>Total Students</div></div>
                        <div class="stat-card"><div class="stat-number" id="monthlyIncome">$0</div><div>Monthly Income</div></div>
                        <div class="stat-card"><div class="stat-number" id="monthlyExpenses">$0</div><div>Monthly Expenses</div></div>
                        <div class="stat-card"><div class="stat-number" id="activeUsers">0</div><div>Active Users</div></div>
                    </div>
                    <div class="nav-menu">
                        <button class="nav-button" id="navStudents" onclick="showView('studentsView')">üë• Students</button>
                        <button class="nav-button" id="navTransactions" onclick="showView('expensesView')">üí∞ Transactions</button>
                        <button class="nav-button" id="navUsers" onclick="showView('usersView')">üë§ Users</button>
                        <button class="nav-button" id="navReports" onclick="showView('reportsView')">üìä Reports</button>
                        <button class="nav-button" id="navSettings" onclick="showView('settingsView')">‚öôÔ∏è Settings</button>
                    </div>
                </div>

                <div id="studentsView" class="hidden">
                    <div class="header">
                        <h2>Student Management</h2>
                        <div>
                            <button class="btn btn-success" id="btnAddStudent" onclick="showModal('addStudentModal')">Add Student</button>
                            <button class="btn btn-secondary" onclick="showView('dashboardView')">Back</button>
                        </div>
                    </div>
                    <div id="studentsAlert"></div>
                    <table class="table" id="studentsTable">
                        <thead><tr><th>Name</th><th>Guardian</th><th>Mobile</th><th>Class</th><th>Join Date</th><th>Status</th><th>Actions</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div id="expensesView" class="hidden">
                    <div class="header">
                        <h2>Transaction Management</h2>
                        <div>
                            <button class="btn btn-success" id="btnAddTransaction" onclick="showModal('addExpenseModal')">Add Transaction</button>
                            <button class="btn btn-secondary" onclick="showView('dashboardView')">Back</button>
                        </div>
                    </div>
                    <div id="expensesAlert"></div>
                    <table class="table" id="expensesTable">
                        <thead><tr><th>Reference</th><th>Date</th><th>Type</th><th>Amount</th><th>In/Out</th><th>Description</th><th>Actions</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div id="usersView" class="hidden">
                    <div class="header">
                        <h2>User Management</h2>
                        <div>
                            <button class="btn btn-success" id="btnAddUser" onclick="openAddUserModal()">Add User</button>
                            <button class="btn btn-secondary" onclick="showView('dashboardView')">Back</button>
                        </div>
                    </div>
                    <div id="usersAlert"></div>
                    <table class="table" id="usersTable">
                        <thead><tr><th>Username</th><th>Role</th><th>Status</th><th>Actions</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div id="reportsView" class="hidden">
                    <div class="header">
                        <h2>Reports & Analytics</h2>
                        <button class="btn btn-secondary" onclick="showView('dashboardView')">Back</button>
                    </div>
                    <div class="form-row" style="margin-bottom: 20px;">
                        <div class="form-group">
                            <label>From Date:</label>
                            <input type="date" id="reportFromDate">
                        </div>
                        <div class="form-group">
                            <label>To Date:</label>
                            <input type="date" id="reportToDate">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>
                    <button class="btn btn-success" id="btnExportReport" onclick="exportToExcel()">Export to Excel</button>
                    <div id="reportsAlert"></div>
                    <div id="reportContent"></div>
                </div>

                <div id="settingsView" class="hidden">
                    <div class="header">
                        <h2>System Settings</h2>
                        <button class="btn btn-secondary" onclick="showView('dashboardView')">Back</button>
                    </div>
                    <div id="settingsAlert"></div>
                    
                    <div class="settings-section">
                        <h3>General Settings</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nursery Name</label>
                                <input type="text" id="nurseryName">
                            </div>
                            <div class="form-group">
                                <label>Currency</label>
                                <input type="text" id="currency" maxlength="3" placeholder="e.g., $, ‚Ç¨, ¬£">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Country/Region</label>
                                <select id="country">
                                    <option value="United States">United States (en-US)</option>
                                    <option value="United Kingdom">United Kingdom (en-GB)</option>
                                    <option value="Kuwait">Kuwait (ar-KW)</option>
                                    <option value="Saudi Arabia">Saudi Arabia (ar-SA)</option>
                                    <option value="UAE">UAE (ar-AE)</option>
                                    <option value="Egypt">Egypt (ar-EG)</option>
                                    <option value="Jordan">Jordan (ar-JO)</option>
                                    <option value="Lebanon">Lebanon (ar-LB)</option>
                                    <option value="France">France (fr-FR)</option>
                                    <option value="Germany">Germany (de-DE)</option>
                                    <option value="Spain">Spain (es-ES)</option>
                                    <option value="Italy">Italy (it-IT)</option>
                                    <option value="India">India (en-IN)</option>
                                    <option value="China">China (zh-CN)</option>
                                    <option value="Japan">Japan (ja-JP)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Timezone</label>
                                <select id="timezone">
                                    <option value="America/New_York">Eastern Time (ET)</option>
                                    <option value="America/Chicago">Central Time (CT)</option>
                                    <option value="America/Denver">Mountain Time (MT)</option>
                                    <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                    <option value="Europe/London">London (GMT)</option>
                                    <option value="Europe/Paris">Paris (CET)</option>
                                    <option value="Asia/Dubai">Dubai (GST)</option>
                                    <option value="Asia/Kuwait">Kuwait</option>
                                    <option value="Asia/Riyadh">Riyadh</option>
                                    <option value="Asia/Amman">Amman</option>
                                    <option value="Asia/Beirut">Beirut</option>
                                    <option value="Asia/Cairo">Cairo</option>
                                    <option value="Asia/Kolkata">India</option>
                                    <option value="Asia/Shanghai">China</option>
                                    <option value="Asia/Tokyo">Tokyo</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="updateSettings()">Save General Settings</button>
                    </div>

                    <div class="settings-section">
                        <h3>Income Sources</h3>
                        <div class="form-group">
                            <label>Income Sources (one per line)</label>
                            <textarea id="incomeSources" rows="4" placeholder="Student&#10;Bank&#10;Staff Advance&#10;Others"></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="updateIncomeSources()">Save Income Sources</button>
                    </div>

                    <div class="settings-section">
                        <h3>Transaction Categories</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Income Categories</label>
                                <textarea id="incomeCategories" rows="5"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Expense Categories</label>
                                <textarea id="expenseCategories" rows="5"></textarea>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="updateCategories()">Save Categories</button>
                    </div>

                    <div class="settings-section">
                        <h3>Payment Methods</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Income Payment Methods</label>
                                <textarea id="incomePaymentMethods" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Expense Payment Methods</label>
                                <textarea id="expensePaymentMethods" rows="3"></textarea>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="updatePaymentMethods()">Save Payment Methods</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="addStudentModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="hideModal('addStudentModal')">&times;</span>
            <h3 id="studentModalTitle">Add Student</h3>
            <form id="addStudentForm">
                <input type="hidden" id="editStudentId">
                <div class="form-row">
                    <div class="form-group"><label>First Name *</label><input type="text" name="firstName" required></div>
                    <div class="form-group"><label>Last Name *</label><input type="text" name="lastName" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Guardian Name *</label><input type="text" name="guardianName" required></div>
                    <div class="form-group"><label>Guardian Mobile *</label><input type="tel" name="guardianMobile" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Class *</label>
                        <select name="class" required>
                            <option value="Nursery 1">Nursery 1</option>
                            <option value="Nursery 2">Nursery 2</option>
                            <option value="KG 1">KG 1</option>
                            <option value="KG 2">KG 2</option>
                        </select>
                    </div>
                    <div class="form-group"><label>Join Date *</label><input type="date" name="joinDate" required></div>
                </div>
                <div class="form-group"><label>Birthday</label><input type="date" name="birthday"></div>
                <div class="form-group"><label>Allergic Notes</label><textarea name="allergicNotes" rows="2"></textarea></div>
                <div class="form-group">
                    <label>Status</label>
                    <select name="status">
                        <option value="Active">Active</option>
                        <option value="On Hold">On Hold</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success" id="btnSubmitStudent">Add Student</button>
                <button type="button" class="btn btn-secondary" onclick="hideModal('addStudentModal')">Cancel</button>
            </form>
        </div>
    </div>

    <div id="addExpenseModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="hideModal('addExpenseModal')">&times;</span>
            <h3 id="expenseModalTitle">Add Transaction</h3>
            <form id="addExpenseForm">
                <input type="hidden" id="editExpenseId">
                <div class="form-row">
                    <div class="form-group"><label>Reference</label><input type="text" name="reference" required></div>
                    <div class="form-group"><label>Date *</label><input type="date" name="date" required></div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Transaction Type *</label>
                        <select name="inOut" id="inOutSelect" required>
                            <option value="">Select Type</option>
                            <option value="In">Income</option>
                            <option value="Out">Expense</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Category *</label>
                        <select name="type" id="typeSelect" required>
                            <option value="">Select Category</option>
                        </select>
                    </div>
                </div>
                <div class="form-group" id="incomeSourceGroup" class="hidden">
                    <label>Income Source</label>
                    <select name="incomeSource" id="incomeSourceSelect">
                        <option value="">Select Source</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Amount *</label><input type="number" name="amount" step="0.01" required></div>
                    <div class="form-group">
                        <label>Payment Method *</label>
                        <select name="paymentMethod" id="paymentMethodSelect" required>
                            <option value="">Select Method</option>
                        </select>
                    </div>
                </div>
                <div class="form-group"><label>Description (supports Arabic)</label><textarea name="description" rows="3" placeholder="ŸäŸÖŸÉŸÜŸÉ ÿßŸÑŸÉÿ™ÿßÿ®ÿ© ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ŸáŸÜÿß..."></textarea></div>
                <button type="submit" class="btn btn-success"